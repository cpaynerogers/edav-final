# Missing values

```{r include=FALSE}
library(ggplot2)
library(dplyr)
library(tidyverse)
library(plyr)
require(scales)
library(mi)
```

```{r}
TABLE_PIXELS = "250px"
```

```{r include=FALSE}
dairy <- read_csv("resources/processed_data/dairy.csv")
fats <- read_csv("resources/processed_data/fats.csv")
fruits <- read_csv("resources/processed_data/fruits.csv")
grains <- read_csv("resources/processed_data/grains.csv")
incidence <- read_csv("resources/processed_data/incidence.csv")
meateggsnuts <- read_csv("resources/processed_data/meateggsnuts.csv")
mortality <- read_csv("resources/processed_data/mortality.csv")
sugars <- read_csv("resources/processed_data/sugars.csv")
vegetables <- read_csv("resources/processed_data/vegetables.csv")
```

<!-- function for creating a missing data table -->
```{r}
find_missing_data <- function(d) {
  colSums(is.na(d)) %>% sort(decreasing=TRUE) %>%
    knitr::kable("html") %>%
    kableExtra::scroll_box(
      height=TABLE_PIXELS,
      width="100%") 
}
```

<!-- function for creating missing data plots -->
```{r}
missing_data_is_fun <- function(d) {
  d <- as.data.frame(d)
  df <- d[, -(1:1)]

  # missing data image
  image(mi::missing_data.frame(df))

  # clustered by missing-ness
  d_tidy <- gather(df, food_type, value, -Year)
  ggplot(d_tidy) +
    geom_tile(aes(x=food_type, y=Year, fill=value)) +
    theme_light() +
    theme(axis.text.x = element_text(angle=60, hjust=1),
          axis.text.y = element_text(size=5))
}
```

The digestive cancer and food data are small enough that we can inspect the raw data and get a sense of what's missing. In doing so, we've observed that no data is missing from the digestive cancer incidence and mortality tables. Some of the food spreadsheets, which go all the way back to 1970, are missing data. Each of those sheets are investigated further, depending on whether they have missing data.

For fats, it seems that the pattern of missing data starts in 2000 for some food types and others the missing data starts in 2010. It seems like either the fats database is updated every decade or added fats is gradually being excluded from this dataset. 

All values are present in the sugars spreadsheet

## Where is Data Missing?

Each table in this section looks and counts missing data. We know that any missing datum shows up in our data as `NA`. Reviewing these results, we can see that the sugar and meat-eggs-nuts sheets have no missing data, while the rest do.

<!-- TODO: combine these tables into one? -->

### Missing Meat, Eggs, Nuts

```{r}
find_missing_data(meateggsnuts)
```

### Missing Dairy

```{r}
find_missing_data(dairy)
```

### Missing Fruit

```{r}
find_missing_data(fruits)
```

### Missing Vegetables

```{r}
find_missing_data(vegetables)
```

### Missing Grains

```{r}
find_missing_data(grains)
```

### Missing Fats

```{r}
find_missing_data(fats)
```

### Missing Sugars

```{r}
find_missing_data(sugars)
```

## Meat, Eggs, Nuts

```{r, results='hide'}
missing_data_is_fun(meateggsnuts)
```

## Dairy

```{r, results='hide'}
missing_data_is_fun(dairy)
```

## Fruits

```{r, results='hide'}
missing_data_is_fun(fruits)
```

## Vegetables

```{r, results='hide'}
missing_data_is_fun(vegetables)
```

## Grains

```{r, results='hide'}
missing_data_is_fun(grains)
```

## Fats

```{r, results='hide'}
missing_data_is_fun(fats)
```

## Sugars

```{r}
missing_data_is_fun(sugars)
```
